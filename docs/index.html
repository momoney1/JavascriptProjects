<html><body>
<form onsubmit="return false">
    <ul class="form-style-1">
        <li><input type="text" id="first" name="field1" class="field-divided" placeholder="First" />
         <input type="text" id="last" name="field2" class="field-divided" placeholder="Last" /></li>
        <li>
          
            <input type="text" id="email" name="field3" class="field-long" placeholder="Email"  />
        </li>
        <li>
          
            <input type="text" id="question" name="field4" class="field-long" placeholder="question and/ or comment" />
        </li>
       
     
        <li>
            <input type="submit" id="button" value="Submit" />
        </li>
    </ul>

    <div class= "mainBody">
       
    
    <style type="text/css">
    .form-style-1 {
        margin:15px auto;
        max-width: 400px;
        padding: 20px 12px 10px 20px;
        font: 13px "Lucida Sans Unicode", "Lucida Grande", sans-serif;
    
    }
    .form-style-1 li {
        padding: 0;
        display: block;
        list-style: none;
        margin: 20px 3px 0 0;
      
    }
    .form-style-1 label{
        margin:0 0 3px 0;
        padding:0px;
        display:block;
        font-weight: bold;
    }
    .form-style-1 input[type=text], 
    .form-style-1 input[type=date],
    .form-style-1 input[type=datetime],
    .form-style-1 input[type=number],
    .form-style-1 input[type=search],
    .form-style-1 input[type=time],
    .form-style-1 input[type=url],
    .form-style-1 input[type=email],
    textarea, 
    select{
        border-radius:20px;
        box-sizing: border-box;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        border:1px solid #BEBEBE;
        padding: 10px;
        margin:0px;
        -webkit-transition: all 0.30s ease-in-out;
        -moz-transition: all 0.30s ease-in-out;
        -ms-transition: all 0.30s ease-in-out;
        -o-transition: all 0.30s ease-in-out;
        outline: none;	
    }
    .form-style-1 input[type=text]:focus, 
    .form-style-1 input[type=date]:focus,
    .form-style-1 input[type=datetime]:focus,
    .form-style-1 input[type=number]:focus,
    .form-style-1 input[type=search]:focus,
    .form-style-1 input[type=time]:focus,
    .form-style-1 input[type=url]:focus,
    .form-style-1 input[type=email]:focus,
    .form-style-1 textarea:focus, 
    .form-style-1 select:focus{
        -moz-box-shadow: 0 0 8px #88D5E9;
        -webkit-box-shadow: 0 0 8px #88D5E9;
        box-shadow: 0 0 8px #88D5E9;
        border: 1px solid #88D5E9;
     
    }
    .form-style-1 .field-divided{
        width: 49%;
        margin: 0 2rem 0 2rem;
        padding:2em
    }
    
    .form-style-1 .field-long{
        width: 100%;
    }
    .form-style-1 .field-select{
        width: 100%;
    }
    .form-style-1 .field-textarea{
        height: 100px;
    }
    .form-style-1 input[type=submit], .form-style-1 input[type=button]{
        background: #0e1f33;
        padding: 12px 15px 12px 15px;
        border: none;
        color: #fff;
      width: 100%;
      border-radius:20px;
    }
    .form-style-1 input[type=submit]:hover, .form-style-1 input[type=button]:hover{
        background: #fff;
        box-shadow:none;
        -moz-box-shadow:none;
        -webkit-box-shadow:none;
        border:1px solid black;
        color:black;
    }
    .form-style-1 .required{
        color:red;
    }

    </style>

</form>

<div class = mainBody>
    
<button class="red">cliquez</button>

<table>

    <tr >

        <th>Doctor</th>

        <th>City</th>

        <th>State</th>

        <th>Fax</th>

        <th>Npi</th>

    </tr>
   

    <tr  class="t1">

        <td id = "1"></td>

        <td id = "2"></td>

        <td id = "3"></td>

        <td id = "4"></td>

        <td id = "5"></td>

    </tr>

       <tr  class="t1">

       <td id = "6"></td>

       <td id = "7"></td>

       <td id = "8"></td>

       <td id = "9"></td>

       <td id = "10"></td>

    </tr>
    
    <tr class="t1">

        <td id = "11"></td>

        <td id = "12"></td>

        <td id = "13"></td>

        <td id = "14"></td>

        <td id = "15"></td>

</tr>

<tr class="t1">

        <td id = "16"></td>

        <td id = "17"></td>

        <td id = "18"></td>

        <td id = "19"></td>

        <td id = "20"></td>

</tr>

<tr class="t1">

        <td id = "21"></td>

        <td id = "22"></td>

        <td id = "23"></td>

        <td id = "24"></td>

        <td id = "25"></td>



</tr>

<tr class="t1">

        <td id = "26"></td>

        <td id = "27"></td>

        <td id = "28"></td>

        <td id = "29"></td>

        <td id = "30"></td>

</tr>

<tr class="t1">

        <td id = "31"></td>

        <td id = "32"></td>

        <td id = "33"></td>

        <td id = "34"></td>

        <td id = "35"></td>

</tr>

       
</table>
    
    <style>
        .mainBody {
  background: rgb(156, 101, 101); 
  color: #323232;

  margin: 0;
  height: 100vh;

  display: flex;
  align-items: center;
  justify-content: center;
  
  font-family: Helvetica neue, roboto;
}

.inputField{
  position: absolute;
  top: 10%;
}
.red{
  align-items: left;
  position: relative;
  top: -20%;
  padding: 0.5% 1.5% 0.5% 1.5%;
}

@import url('https://fonts.googleapis.com/css?family=Montserrat|Open+Sans|Roboto');
*{
 margin:0;
 padding: 0;
 outline: 0;
}
.filter{
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 z-index: 1;

}
table{
 position: absolute;
 z-index: 2;
 left: 50%;
 top: 70%;
 transform: translate(-70%,-50%);
 width: 60%; 
 border-collapse: collapse;
 border-spacing: 0;
 box-shadow: 0 2px 15px rgba(64,64,64,.7);
 border-radius: 12px 12px 0 0;
 overflow: hidden;

}
td , th{
 padding: 15px 20px;
 text-align: center;
 

}
th{
 background-color: #a8a4a8;
 color: #fafafa;
 font-family: 'Open Sans',Sans-serif;
 font-weight: 200;
 text-transform: uppercase;

}
tr{
 width: 100%;
 background-color: #fafafa;
 font-family: 'Montserrat', sans-serif;
}
tr:nth-child(even){
 background-color: #eeeeee;
}

.hover{
  background-color:rgb(109, 1, 1);
}

.hey:hover{
  background-color: rgb(190, 186, 186);
}

#btn{
  background-color: red;
}
    </style>
</div>

    <script>
         const proxyurl = "https://cors-anywhere.herokuapp.com/"; //add a timeout delay here to fix
         const url = "https://npiregistry.cms.hhs.gov/api"; //check https://developer.betterdoctor.com/faq  for other api options or https://www.programmableweb.com/news/5-best-healthcare-apis-medical-app-development/brief/2020/05/14
//create new url element that produces a secondary search to gather additional info on doctor
//also find a way to connect to faxage site in order to send fax to doctor
window.addEventListener("load",function () {
    document.getElementById('button').addEventListener("click",(event) => { //search button activation
    setTimeout(RetriveInfoViaNPI, 2000);

	})
});


function RetriveInfoViaNPI() {
	let targetFName = document.getElementById("first").value;
	let targetLname = document.getElementById("last").value;
	let targetState = document.getElementById("email").value;
    let targetcity = document.getElementById("question").value;
    //problem occurs with return value of targetState because on the gov site, its not a text box input, its a toggle down menu. so much modify javascript
    let fullUrl = `${url}?last_name=${targetLname}&first_name=${targetFName}&state=${targetState}&city=${targetcity}&limit=25&version=2.1`;
	let spinOptions = {
		"duration": 1000,
		"delay": 0,
		"direction": "ccw",
		"cycles": 10
	};
        
	npibackendpull(fullUrl).then(json => { 
		//document.getElementById("message").show()
        let rows = document.querySelector('table').rows;
        console.log(json.results[0].basic.first_name);
        console.log(json.results.length);
        let numOfObj = 0;
        let matchNumOfObj = 0;
        let j = 0;
        for(let i = 0; i < json.results.length; i++){
            if(json.results[i].basic.first_name === document.getElementById("first").value.toUpperCase() && 
            json.results[i].basic.last_name === document.getElementById("last").value.toUpperCase()){
                numOfObj++;
                console.log(json.results[i].basic.first_name);
            }
        }

        let found = false;
		json.results.forEach(function (obj) { //json returned may contain multiple doctors, this loops through each one
			var res = obj.addresses; //andrea or andrew's addresses
            var nameinfo = obj.basic;
            
            res.forEach(function (add) {//checking one doctor's multiple addresses
            
                if(found === false){
                    if (obj.number > 1) {
                    Object.keys(obj).some(key => {//method returns an array of a given object's own enumerable property. the some() method checks to see 
                //if at least one of the keys matches "value" (npi number
                    console.log(obj);
                    console.log(key, 'key');
                    console.log(add.address_purpose);
                    console.log(add.address_purpose === 'LOCATION');
                    console.log(obj[key] === obj.number, 'obj[key] === value');
                    console.log(obj[key], 'obj[key]');
                    console.log(document.getElementById("first").value.toUpperCase())

                    if(obj[key] === obj.number && obj.basic.first_name == document.getElementById("first").value.toUpperCase() 
                    && obj.basic.last_name == document.getElementById("last").value.toUpperCase() && add.address_purpose === 'LOCATION'){
                        let docString = nameinfo.name + " "+ add.city + "  "+ add.state + " "+ add.fax_number + " "+ obj.number;
                        document.getElementById(j + 1 + "").innerHTML = nameinfo.name;
                        document.getElementById(j + 2 + "").innerHTML = add.city;
                        document.getElementById(j + 3 + "").innerHTML = add.state;
                        document.getElementById(j + 4 + "").innerHTML = add.fax_number;
                        document.getElementById(j + 5 + "").innerHTML = obj.number;
                        j += 5;
                        console.log(docString);
                        matchNumOfObj++;
                        if(matchNumOfObj === numOfObj){
                            found = true;
                        } 
                        return true;
                    }else{
                        return false;
                    } 
                });
				}
                }
			})
		;})
	})
}

function npibackendpull(url) {
 return fetch(proxyurl + url, 
     {
                method: "get",
                headers: 
         {
           "Access-Control-Allow-Origin": "*",
           "Content-Type": "application/json",
           "Retry-After": "3600"
           
          }
          
     })
     .then(httpResponse => httpResponse.json(), httpResponse2 =>  npibackendpull(url));//.then method returns a promise. the two arguments represent success or failure cases for the promise
    }

    </script>
</body>


</html>
